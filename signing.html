<!doctype html>
<!--[if IE 9]>
<html class="lt-ie10" lang="en"> <![endif]-->
<html class="no-js" lang="en" data-useragent="Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Release Signing</title>


    <meta name="description"
          content="Linux Embedded Development Environment, an embedded Linux distribution that makes it easy for developers, system administrators or other Linux enthusiasts to build and customize software for embedded devices, especially wireless routers."/>

    <link rel="stylesheet" href="/lede-web/css/foundation.css"/>
    <link rel="stylesheet" href="/lede-web/css/font-awesome.css"/>
    <link rel="stylesheet" href="/lede-web/css/coderay.css"/>
    <link rel="stylesheet" href="/lede-web/css/asciidoctor.css"/>
    <link rel="stylesheet" href="/lede-web/css/lede.css"/>
    <script src="/lede-web/js/vendor/modernizr.js"></script>
    <script src="/lede-web/js/toc.js"></script>
</head>
<body>


<!-- Nav Bar -->

<nav class="top-bar" data-topbar>
    <ul class="title-area">
        <!-- Title Area -->
        <li class="name">
            <h1>
                <a href="#">
                    <img src="/lede-web/logo/logo_small.png"></img>
                    <span>Release Signing</span>
                </a>
            </h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
        <!-- Right Nav Section -->
        <ul class="right">
            <li><a href="/lede-web/index.html">Home</a></li>
<li><a href="/lede-web/communication.html">Communication</a></li>
<li><a href="/lede-web/rules.html">Rules</a></li>
<li><a href="/lede-web/development.html">Development</a></li>
<li><a href="/lede-web/todo.html">Todo</a></li>
<li><a href="/lede-web/downloads.html">Downloads</a></li>
<li><a href="/lede-web/docs/index.html">Documentation</a></li>
<li><a href="/lede-web/about.html">About</a></li>

        </ul>
    </section>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->

<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns" role="content">

        <div class="sect1">
<h2 id="signing_approach">Signing Approach</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LEDE uses both <a href="https://www.gnupg.org/">GnuPG</a> and <em>usign</em>, a derivate of the
OpenBSD <a href="http://www.openbsd.org/papers/bsdcan-signify.html"><em>signify</em></a> utilitiy.</p>
</div>
<div class="paragraph">
<p>The <em>OPKG</em> package manager uses <em>usign</em> Ed25519 signatures to verify repository
metadata when installing packages while release image files are usually signed
by one or more developers with detached GPG signatures to allow users to verify
the integrity of installation files.</p>
</div>
<div class="paragraph">
<p>Our <em>usign</em> signature files carry the extension <code>.sig</code> while the detached
GPG signatures end with <code>.gpg</code>.</p>
</div>
<div class="paragraph">
<p>Note that not every file is signed individually but that we&#8217;re signing the
<code>md5sums</code> and <code>sha256sums</code> or - for repositories - the <code>Packages</code> files to
establish a chain of trust: The SHA256 checksum will verify the integrity of the
actual file while the signature will verify the integrity of the file containing
the checksums.</p>
</div>
<div class="sect2">
<h3 id="verify_download_integrity">Verify download integrity</h3>
<div class="paragraph">
<p>In order to verify the integrity of a firmware download you need to do the
following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the <code>sha256sum</code> and <code>sha256sum.gpg</code> files</p>
</li>
<li>
<p>Check the signature with <code>gpg --with-fingerprint --verify sha256sum.gpg
sha256sum</code>, ensure that the GnuPG command reports a good signature and that
the fingerprint matches the ones listed on our fingerprints (TODO:link) page.</p>
</li>
<li>
<p>Download the firmware image and calculate its hash using one of the
<code>sha256sum</code> or <code>openssl sha256</code> commands.</p>
</li>
<li>
<p>Verify that the calculated checksum matches the one listed in the <code>sha256sums</code>
file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can use the example script below to verify the integrity of image downloads,
call it as <code>./script.sh <a href="https://downloads.lede-project.org/path/to/image.bin" class="bare">https://downloads.lede-project.org/path/to/image.bin</a></code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash

[ -n "$1" ] || {
	echo "Usage: $0 &lt;url&gt;" &gt;&amp;2
	exit 1
}

finish() {
	echo "Cleaning up."
	rm -r "/tmp/verify.$$"
	exit $1
}

trap "finish 7" INT TERM

destdir="$(pwd)"
image_url="$1"
image_file="${image_url##*/}"
sha256_url="${image_url%/*}/sha256sums"
gpgsig_url="${image_url%/*}/sha256sums.gpg"

mkdir -p "/tmp/verify.$$"
cd "/tmp/verify.$$"

echo "1) Downloading image file"
echo "========================="
wget -O "$image_file" "$image_url" || {
	echo "Failed to download image file!" &gt;&amp;2
	finish 1
}

echo "2) Downloading checksum file"
echo "============================"
wget -O "sha256sums" "$sha256_url" || {
	echo "Failed to download checksum file!" &gt;&amp;2
	finish 2
}

echo "3) Downloading the GPG signature"
echo "================================"
wget -O "sha256sums.gpg" "$gpgsig_url" || {
	echo "Failed to download GPG signature!" &gt;&amp;2
	finish 3
}

echo "4) Verifying GPG signature"
echo "=========================="
gpg --with-fingerprint --verify "sha256sums.gpg" "sha256sums" || {
	echo "Failed to verify checksum file with GPG signature!" &gt;&amp;2
	finish 4
}

echo ""
echo "5) Verifying SHA256 checksum"
echo "============================"
remote_csum="$(grep -F "SHA256($image_file)=" "sha256sums")"
local_csum="$(openssl sha256 "$image_file")"
[ "$remote_csum" = "$local_csum" ] || {
	echo "Checksums do not match!" &gt;&amp;2
	echo "REMOTE: $remote_csum" &gt;&amp;2
	echo "LOCAL:  $local_csum" &gt;&amp;2
	finish 5
}

cp "$image_file" "$destdir/$image_file" || {
	echo "Failed to write '$destdir/$image_file'" &gt;&amp;2
	finish 6
}

echo ""
echo "Verficiation done!"
echo "=================="
echo "Firmware image placed in '$dest_dir/$image_file'."

finish 0</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="developer_information">Developer information</h3>
<div class="paragraph">
<p>Developers participating in the LEDE project need to provide both <em>GnuPG</em> and
<em>usign</em> public keys which are stored in the central
<a href="https://git.lede-project.org/?p=keyring.git">keyring.git</a> repository.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="/keygen.html">key generation howto</a> page for instruction on how to
generate suitable signing keys.</p>
</div>
</div>
</div>
</div>

    </div>

    <!-- End Main Content -->

    <!-- Sidebar -->

    <aside class="large-3 columns">
        
            <h4>Links</h4>
<div class="panel">
    <ul class="fa-ul">
        <li><i class="fa-li fa fa-download" aria-hidden="true"></i><a href="https://downloads.lede-project.org/snapshots/targets/">Downloads</a></li>
        <li><i class="fa-li fa fa-code-fork" aria-hidden="true"></i><a href="https://git.lede-project.org/">Git Repos</a></li>
        <li><i class="fa-li fa fa-github" aria-hidden="true"></i><a href="https://github.com/lede-project">Github</a></li>
        <li><i class="fa-li fa fa-archive" aria-hidden="true"></i><a href="https://sources.lede-project.org/">Source Archives</a></li>
        <li><i class="fa-li fa fa-envelope" aria-hidden="true"></i><a href="http://lists.infradead.org/mailman/listinfo/lede-dev">Mailing List</a></li>
        <li><i class="fa-li fa fa-twitter" aria-hidden="true"></i><a href="https://twitter.com/lede_project">Twitter</a></li>
        <li><i class="fa-li fa fa-comment" aria-hidden="true"></i><a href="irc://irc.freenode.org/lede-dev">IRC</a></li>
    </ul>
</div>

        
    </aside>

    <!-- End Sidebar -->
</div>

<!-- End Main Content and Sidebar -->


<!-- Footer -->

<footer class="row">
    <div class="large-12 columns">
        <hr/>
        <div class="row">
            <div class="large-12 columns">
                <p>Last updated 2016-05-24 14:04:37</p>
            </div>
        </div>
    </div>
</footer>

<script src="/lede-web/js/vendor/jquery.js"></script>
<script src="/lede-web/js/foundation.min.js"></script>
<script>
    $(document).foundation();

    var doc = document.documentElement;
    doc.setAttribute('data-useragent', navigator.userAgent);
</script>
</body>
</html>
